import * as Path from "path";
import { Package } from "./lib/Packaging/Package";
import { RequiredPackageDescriptor } from "./lib/Packaging/RequiredPackageDescriptor";
import { ThemeInstructionCollection } from "./lib/Appearance/Themes/ThemeInstructionCollection";
import { UpdateInstructionCollection } from "./lib/Automation/UpdateInstructionCollection";

function getComponentsPath(value: string): string
{
    return Path.join(__dirname, "components", value);
}

let pkg: IPackageOptions = {
    Identifier: "<%= identifier %>",
    Name: "<%= name %>",
    DisplayName: {
        inv: "<%= displayName %>"
    },
    CreationDate: new Date("<% let date = new Date(); %><%=
        date.getFullYear() + "/" +
        (date.getMonth() + 1).toString().padStart(2, "0") + "/" +
        date.getDate().toString().padStart(2, "0") %>"),
    Description: {
        inv: "<%= description %>"
    },
    InstallSet: {
        Instructions: [<%
            let items = [];

            for (let component of components)
            {
                let optionName = "";
                let item = "";
                let formatter;

                switch (component)
                {
                    case "theme":
                        formatter = (value) =>
                        {
                            return "...new ThemeInstructionCollection(\"" + value + "\")";
                        }
                        break;
                    default:
                        formatter = (value) =>
                        {
                            return "require(getComponentsPath(\"" + value + "\"))";
                        }
                        break;
                }

                items.push(formatter(componentPaths[component]));
            }
        %>
            <%- items.join(`,
            `) %>
        ]
    },
    RequiredPackages: [
        new RequiredPackageDescriptor({
            Identifier: "com.woltlab.wcf",
            MinVersion: "3.0.0"
        })
    ]
});

export = pkg;